{
  "name": "Safe Runner",
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu-22.04",

  "features": {
    "ghcr.io/devcontainers/features/node:1": { "version": "lts" },
    "ghcr.io/devcontainers/features/python:1": { "version": "latest" },
    "ghcr.io/devcontainers/features/php:1": { "version": "latest", "installComposer": true },
    "ghcr.io/devcontainers/features/github-cli:1": { "version": "latest" },
    "ghcr.io/devcontainers/features/go:1": { "version": "latest" }
  },

  "customizations": {
    "codespaces": {
      "repositories": {
        "permissions": { "codespaces": "write" }
      }
    }
  },

  "runArgs": [
    "--cap-drop=SYS_ADMIN",
    "--cap-drop=NET_ADMIN",
    "--cap-drop=SYS_PTRACE",
    "--security-opt=no-new-privileges",
    "--pids-limit=256",
    "--init"
  ],

  "containerEnv": {
    "SAFE_RUN_ENV": "true"
  },

  // SETUP COMMANDS
  // 1. Install Semgrep (SAST) via pip (user level)
  // 2. Install OSV-Scanner (SCA) via Go
  // 3. Make scripts executable
  // 4. Setup aliases
  "postCreateCommand": "pip install --user semgrep && go install github.com/google/osv-scanner/cmd/osv-scanner@v1 && chmod +x audit.sh run.sh rules/*.sh",

  "postStartCommand": "echo 'alias nuke=\"gh codespace delete --current --force\"' >> /home/vscode/.bashrc && nohup bash -c 'sleep 7200 && gh codespace delete --current --force' > /dev/null 2>&1 & echo 'âœ… Safe Runner Active. Tools: Semgrep (SAST) & OSV-Scanner (SCA) installed.'"
}